const translations = {
    'en': {
        'title': 'SiliconFlow Balance Assistant',
        'subtitle': 'API Balance Checker',
        'placeholder': 'Enter your API Key (sk-...)',
        'checkBtn': 'Check Balance',
        'checking': 'Checking...',
        'totalBalance': 'Total Balance',
        'status': 'Status',
        'userId': 'User ID',
        'statusActive': 'Active',
        'statusBlocked': 'Blocked',
        'errorEmpty': 'Please enter your API Key',
        'errorGeneric': 'Failed to get user info',
        'errorFormat': 'Unknown response format',
        'unknownUser': 'Unknown User',
        'noEmail': 'No Email',
        'errorTitle': 'Error',
        'userNamePersonal': 'Personal',
        'trackThisKey': 'Track This API Key',
        'trackHint': 'Enable to periodically record balance changes',
        'balanceHistory': 'Balance History',
        'balance': 'Balance',
        'balance': 'Balance',
        'trackingError': 'Failed to update tracking status',
        'userStatusTitle': 'User Status',
        'remaining': 'Remaining',
        'used': 'Used',
        'updateTime': 'Update Time',
        'burnRate': 'Burn Rate',
        'minimal': 'Minimal',
        'fast': 'Fast',
        'veryFast': 'Very Fast',
        'etaEmpty': 'ETA Empty',
        'safe': 'Safe',
        'lessThan24h': '< 24h',
        'lessThan3d': '< 3d',
        'sessionUsed': 'Total Used',
        'trackedKey': 'Tracked Key',
        'days': 'd',
        'hours': 'h',
        'minutes': 'm',
        'nextRefresh': 'Refresh:'
    },
    'zh-CN': {
        'title': 'SiliconFlow 余额助手',
        'subtitle': 'API 余额查询工具',
        'placeholder': '输入您的 API Key (sk-...)',
        'checkBtn': '查询余额',
        'checking': '查询中...',
        'totalBalance': '总余额',
        'status': '账号状态',
        'userId': '用户 ID',
        'statusActive': '正常',
        'statusBlocked': '已封禁',
        'errorEmpty': '请输入您的 API Key',
        'errorGeneric': '获取用户信息失败',
        'errorFormat': '未知的响应格式',
        'unknownUser': '未知用户',
        'noEmail': '无邮箱',
        'errorTitle': '错误',
        'userNamePersonal': '个人',
        'trackThisKey': '跟踪此 API Key',
        'trackHint': '启用后将定期记录余额变化',
        'balanceHistory': '余额历史',
        'balance': '余额',
        'balance': '余额',
        'trackingError': '更新跟踪状态失败',
        'userStatusTitle': '用户状态',
        'remaining': '剩余',
        'used': '已用',
        'updateTime': '更新时间',
        'burnRate': '消耗速率',
        'minimal': '极低',
        'fast': '快',
        'veryFast': '极快',
        'etaEmpty': '预计耗尽',
        'safe': '安全',
        'lessThan24h': '< 24小时',
        'lessThan3d': '< 3天',
        'sessionUsed': '累计消耗',
        'trackedKey': '跟踪的 Key',
        'days': '天',
        'hours': '小时',
        'minutes': '分',
        'nextRefresh': '刷新:'
    },
    'zh-TW': {
        'title': 'SiliconFlow 餘額助手',
        'subtitle': 'API 餘額查詢工具',
        'placeholder': '輸入您的 API Key (sk-...)',
        'checkBtn': '查詢餘額',
        'checking': '查詢中...',
        'totalBalance': '總餘額',
        'status': '帳號狀態',
        'userId': '用戶 ID',
        'statusActive': '正常',
        'statusBlocked': '已封禁',
        'errorEmpty': '請輸入您的 API Key',
        'errorGeneric': '獲取用户信息失敗',
        'errorFormat': '未知的響應格式',
        'unknownUser': '未知用戶',
        'noEmail': '無郵箱',
        'errorTitle': '錯誤',
        'userNamePersonal': '個人',
        'trackThisKey': '追蹤此 API Key',
        'trackHint': '啟用後將定期記錄餘額變化',
        'balanceHistory': '餘額歷史',
        'balance': '餘額',
        'balance': '餘額',
        'trackingError': '更新追蹤狀態失敗',
        'userStatusTitle': '用戶狀態',
        'remaining': '剩餘',
        'used': '已用',
        'updateTime': '更新時間',
        'burnRate': '消耗速率',
        'minimal': '極低',
        'fast': '快',
        'veryFast': '極快',
        'etaEmpty': '預計耗盡',
        'safe': '安全',
        'lessThan24h': '< 24小時',
        'lessThan3d': '< 3天',
        'sessionUsed': '累計消耗',
        'trackedKey': '追蹤的 Key',
        'days': '天',
        'hours': ' 小時',
        'minutes': ' 分',
        'nextRefresh': '刷新:'
    },
    'ja': {
        'title': 'SiliconFlow 残高アシスタント',
        'subtitle': 'API 残高照会ツール',
        'placeholder': 'APIキーを入力してください (sk-...)',
        'checkBtn': '残高確認',
        'checking': '確認中...',
        'totalBalance': '総残高',
        'status': 'ステータス',
        'userId': 'ユーザーID',
        'statusActive': '有効',
        'statusBlocked': '停止中',
        'errorEmpty': 'APIキーを入力してください',
        'errorGeneric': 'ユーザー情報の取得に失敗しました',
        'errorFormat': '不明な応答形式',
        'unknownUser': '不明なユーザー',
        'noEmail': 'メールなし',
        'errorTitle': 'エラー',
        'userNamePersonal': '個人',
        'trackThisKey': 'このAPIキーを追跡',
        'trackHint': '有効にすると残高の変化が定期的に記録されます',
        'balanceHistory': '残高履歴',
        'balance': '残高',
        'balance': '残高',
        'trackingError': '追跡ステータスの更新に失敗しました',
        'userStatusTitle': 'ステータス',
        'remaining': '残り',
        'used': '使用済み',
        'updateTime': '更新時間',
        'burnRate': '消費ペース',
        'minimal': '極低',
        'fast': '速い',
        'veryFast': '極速',
        'etaEmpty': '枯渇予想',
        'safe': '安全',
        'lessThan24h': '< 24時間',
        'lessThan3d': '< 3日',
        'sessionUsed': '累積消費',
        'trackedKey': '追跡中キー',
        'days': '日',
        'hours': '時間',
        'minutes': '分',
        'nextRefresh': '更新:'
    }
};

let currentLang = 'zh-CN'; // Default to zh-CN as per user content context, or detection

function setLanguage(lang) {
    if (translations[lang]) {
        currentLang = lang;
        localStorage.setItem('sf_lang', lang);
        applyTranslations();
        // Dispatch event for other scripts to react
        window.dispatchEvent(new Event('languageChanged'));
    }
}

function t(key) {
    return translations[currentLang][key] || key;
}

function applyTranslations() {
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[currentLang][key]) {
            if (element.tagName === 'INPUT' && element.getAttribute('placeholder')) {
                element.placeholder = translations[currentLang][key];
            } else {
                // If the element has children (like the button with loader), we need to be careful not to remove the loader.
                // For the button, looking at index.html, it has <span class="btn-text">Check Balance</span>.
                // We should probably put data-i18n on the span.
                element.textContent = translations[currentLang][key];
            }
        }
    });

    // Update HTML lang attribute
    document.documentElement.lang = currentLang;
}

function initLanguage() {
    const savedLang = localStorage.getItem('sf_lang');
    if (savedLang && translations[savedLang]) {
        currentLang = savedLang;
    } else {
        const browserLang = navigator.language;
        if (browserLang.includes('zh-CN') || browserLang.includes('zh-SG')) {
            currentLang = 'zh-CN';
        } else if (browserLang.includes('zh-TW') || browserLang.includes('zh-HK')) {
            currentLang = 'zh-TW';
        } else if (browserLang.includes('ja')) {
            currentLang = 'ja';
        } else {
            currentLang = 'en';
        }
    }

    // Set the selector value if it exists
    const langSelect = document.getElementById('langSelect');
    if (langSelect) {
        langSelect.value = currentLang;
    }

    applyTranslations();
}
